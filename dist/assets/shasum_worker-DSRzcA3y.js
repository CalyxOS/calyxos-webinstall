(function(){"use strict";const j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q="ARRAYBUFFER not supported by this environment",V="UINT8ARRAY not supported by this environment";function W(s,t,e,n){let i,o,u;const a=t||[0],c=(e=e||0)>>>3,f=n===-1?3:0;for(i=0;i<s.length;i+=1)u=i+c,o=u>>>2,a.length<=o&&a.push(0),a[o]|=s[i]<<8*(f+n*(u%4));return{value:a,binLen:8*s.length+e}}function T(s,t,e){switch(t){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(s){case"HEX":return function(n,i,o){return function(u,a,c,f){let g,h,w,d;if(u.length%2!=0)throw new Error("String of HEX type must be in byte increments");const m=a||[0],A=(c=c||0)>>>3,p=f===-1?3:0;for(g=0;g<u.length;g+=2){if(h=parseInt(u.substr(g,2),16),isNaN(h))throw new Error("String of HEX type contains invalid characters");for(d=(g>>>1)+A,w=d>>>2;m.length<=w;)m.push(0);m[w]|=h<<8*(p+f*(d%4))}return{value:m,binLen:4*u.length+c}}(n,i,o,e)};case"TEXT":return function(n,i,o){return function(u,a,c,f,g){let h,w,d,m,A,p,y,N,v=0;const E=c||[0],b=(f=f||0)>>>3;if(a==="UTF8")for(y=g===-1?3:0,d=0;d<u.length;d+=1)for(h=u.charCodeAt(d),w=[],128>h?w.push(h):2048>h?(w.push(192|h>>>6),w.push(128|63&h)):55296>h||57344<=h?w.push(224|h>>>12,128|h>>>6&63,128|63&h):(d+=1,h=65536+((1023&h)<<10|1023&u.charCodeAt(d)),w.push(240|h>>>18,128|h>>>12&63,128|h>>>6&63,128|63&h)),m=0;m<w.length;m+=1){for(p=v+b,A=p>>>2;E.length<=A;)E.push(0);E[A]|=w[m]<<8*(y+g*(p%4)),v+=1}else for(y=g===-1?2:0,N=a==="UTF16LE"&&g!==1||a!=="UTF16LE"&&g===1,d=0;d<u.length;d+=1){for(h=u.charCodeAt(d),N===!0&&(m=255&h,h=m<<8|h>>>8),p=v+b,A=p>>>2;E.length<=A;)E.push(0);E[A]|=h<<8*(y+g*(p%4)),v+=2}return{value:E,binLen:8*v+f}}(n,t,i,o,e)};case"B64":return function(n,i,o){return function(u,a,c,f){let g,h,w,d,m,A,p,y=0;const N=a||[0],v=(c=c||0)>>>3,E=f===-1?3:0,b=u.indexOf("=");if(u.search(/^[a-zA-Z0-9=+/]+$/)===-1)throw new Error("Invalid character in base-64 string");if(u=u.replace(/=/g,""),b!==-1&&b<u.length)throw new Error("Invalid '=' found in base-64 string");for(h=0;h<u.length;h+=4){for(m=u.substr(h,4),d=0,w=0;w<m.length;w+=1)g=j.indexOf(m.charAt(w)),d|=g<<18-6*w;for(w=0;w<m.length-1;w+=1){for(p=y+v,A=p>>>2;N.length<=A;)N.push(0);N[A]|=(d>>>16-8*w&255)<<8*(E+f*(p%4)),y+=1}}return{value:N,binLen:8*y+c}}(n,i,o,e)};case"BYTES":return function(n,i,o){return function(u,a,c,f){let g,h,w,d;const m=a||[0],A=(c=c||0)>>>3,p=f===-1?3:0;for(h=0;h<u.length;h+=1)g=u.charCodeAt(h),d=h+A,w=d>>>2,m.length<=w&&m.push(0),m[w]|=g<<8*(p+f*(d%4));return{value:m,binLen:8*u.length+c}}(n,i,o,e)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(q)}return function(n,i,o){return function(u,a,c,f){return W(new Uint8Array(u),a,c,f)}(n,i,o,e)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(V)}return function(n,i,o){return W(n,i,o,e)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function Z(s,t,e,n){switch(s){case"HEX":return function(i){return function(o,u,a,c){const f="0123456789abcdef";let g,h,w="";const d=u/8,m=a===-1?3:0;for(g=0;g<d;g+=1)h=o[g>>>2]>>>8*(m+a*(g%4)),w+=f.charAt(h>>>4&15)+f.charAt(15&h);return c.outputUpper?w.toUpperCase():w}(i,t,e,n)};case"B64":return function(i){return function(o,u,a,c){let f,g,h,w,d,m="";const A=u/8,p=a===-1?3:0;for(f=0;f<A;f+=3)for(w=f+1<A?o[f+1>>>2]:0,d=f+2<A?o[f+2>>>2]:0,h=(o[f>>>2]>>>8*(p+a*(f%4))&255)<<16|(w>>>8*(p+a*((f+1)%4))&255)<<8|d>>>8*(p+a*((f+2)%4))&255,g=0;g<4;g+=1)m+=8*f+6*g<=u?j.charAt(h>>>6*(3-g)&63):c.b64Pad;return m}(i,t,e,n)};case"BYTES":return function(i){return function(o,u,a){let c,f,g="";const h=u/8,w=a===-1?3:0;for(c=0;c<h;c+=1)f=o[c>>>2]>>>8*(w+a*(c%4))&255,g+=String.fromCharCode(f);return g}(i,t,e)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(q)}return function(i){return function(o,u,a){let c;const f=u/8,g=new ArrayBuffer(f),h=new Uint8Array(g),w=a===-1?3:0;for(c=0;c<f;c+=1)h[c]=o[c>>>2]>>>8*(w+a*(c%4))&255;return g}(i,t,e)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(V)}return function(i){return function(o,u,a){let c;const f=u/8,g=a===-1?3:0,h=new Uint8Array(f);for(c=0;c<f;c+=1)h[c]=o[c>>>2]>>>8*(g+a*(c%4))&255;return h}(i,t,e)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const F=4294967296,l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],U=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],S=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],M="Chosen SHA variant is not supported",G="Cannot set numRounds with MAC";function P(s,t){let e,n;const i=s.binLen>>>3,o=t.binLen>>>3,u=i<<3,a=4-i<<3;if(i%4!=0){for(e=0;e<o;e+=4)n=i+e>>>2,s.value[n]|=t.value[e>>>2]<<u,s.value.push(0),s.value[n+1]|=t.value[e>>>2]>>>a;return(s.value.length<<2)-4>=o+i&&s.value.pop(),{value:s.value,binLen:s.binLen+t.binLen}}return{value:s.value.concat(t.value),binLen:s.binLen+t.binLen}}function J(s){const t={outputUpper:!1,b64Pad:"=",outputLen:-1},e=s||{},n="Output length must be a multiple of 8";if(t.outputUpper=e.outputUpper||!1,e.b64Pad&&(t.b64Pad=e.b64Pad),e.outputLen){if(e.outputLen%8!=0)throw new Error(n);t.outputLen=e.outputLen}else if(e.shakeLen){if(e.shakeLen%8!=0)throw new Error(n);t.outputLen=e.shakeLen}if(typeof t.outputUpper!="boolean")throw new Error("Invalid outputUpper formatting option");if(typeof t.b64Pad!="string")throw new Error("Invalid b64Pad formatting option");return t}function K(s,t,e,n){const i=s+" must include a value and format";if(!t){if(!n)throw new Error(i);return n}if(t.value===void 0||!t.format)throw new Error(i);return T(t.format,t.encoding||"UTF8",e)(t.value)}class D{constructor(t,e,n){const i=n||{};if(this.t=e,this.i=i.encoding||"UTF8",this.numRounds=i.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=t,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(t){let e,n=0;const i=this.m>>>5,o=this.C(t,this.h,this.u),u=o.binLen,a=o.value,c=u>>>5;for(e=0;e<c;e+=i)n+this.m<=u&&(this.U=this.v(a.slice(e,e+i),this.U),n+=this.m);return this.A+=n,this.h=a.slice(n>>>5),this.u=u%this.m,this.l=!0,this}getHash(t,e){let n,i,o=this.R;const u=J(e);if(this.K){if(u.outputLen===-1)throw new Error("Output length must be specified in options");o=u.outputLen}const a=Z(t,o,this.T,u);if(this.H&&this.g)return a(this.g(u));for(i=this.F(this.h.slice(),this.u,this.A,this.L(this.U),o),n=1;n<this.numRounds;n+=1)this.K&&o%32!=0&&(i[i.length-1]&=16777215>>>24-o%32),i=this.F(i,o,0,this.B(this.o),o);return a(i)}setHMACKey(t,e,n){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");const i=T(e,(n||{}).encoding||"UTF8",this.T);this.k(i(t))}k(t){const e=this.m>>>3,n=e/4-1;let i;if(this.numRounds!==1)throw new Error(G);if(this.H)throw new Error("MAC key already set");for(e<t.binLen/8&&(t.value=this.F(t.value,t.binLen,0,this.B(this.o),this.R));t.value.length<=n;)t.value.push(0);for(i=0;i<=n;i+=1)this.S[i]=909522486^t.value[i],this.p[i]=1549556828^t.value[i];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(t,e){const n=J(e);return Z(t,this.R,this.T,n)(this.Y())}Y(){let t;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");const e=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return t=this.v(this.p,this.B(this.o)),t=this.F(e,this.R,this.m,t,this.R),t}}function C(s,t){return s<<t|s>>>32-t}function R(s,t){return s>>>t|s<<32-t}function Q(s,t){return s>>>t}function _(s,t,e){return s^t^e}function tt(s,t,e){return s&t^~s&e}function et(s,t,e){return s&t^s&e^t&e}function wt(s){return R(s,2)^R(s,13)^R(s,22)}function I(s,t){const e=(65535&s)+(65535&t);return(65535&(s>>>16)+(t>>>16)+(e>>>16))<<16|65535&e}function ft(s,t,e,n){const i=(65535&s)+(65535&t)+(65535&e)+(65535&n);return(65535&(s>>>16)+(t>>>16)+(e>>>16)+(n>>>16)+(i>>>16))<<16|65535&i}function k(s,t,e,n,i){const o=(65535&s)+(65535&t)+(65535&e)+(65535&n)+(65535&i);return(65535&(s>>>16)+(t>>>16)+(e>>>16)+(n>>>16)+(i>>>16)+(o>>>16))<<16|65535&o}function lt(s){return R(s,7)^R(s,18)^Q(s,3)}function gt(s){return R(s,6)^R(s,11)^R(s,25)}function dt(s){return[1732584193,4023233417,2562383102,271733878,3285377520]}function nt(s,t){let e,n,i,o,u,a,c;const f=[];for(e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],c=0;c<80;c+=1)f[c]=c<16?s[c]:C(f[c-3]^f[c-8]^f[c-14]^f[c-16],1),a=c<20?k(C(e,5),tt(n,i,o),u,1518500249,f[c]):c<40?k(C(e,5),_(n,i,o),u,1859775393,f[c]):c<60?k(C(e,5),et(n,i,o),u,2400959708,f[c]):k(C(e,5),_(n,i,o),u,3395469782,f[c]),u=o,o=i,i=C(n,30),n=e,e=a;return t[0]=I(e,t[0]),t[1]=I(n,t[1]),t[2]=I(i,t[2]),t[3]=I(o,t[3]),t[4]=I(u,t[4]),t}function mt(s,t,e,n){let i;const o=15+(t+65>>>9<<4),u=t+e;for(;s.length<=o;)s.push(0);for(s[t>>>5]|=128<<24-t%32,s[o]=4294967295&u,s[o-1]=u/F|0,i=0;i<s.length;i+=16)n=nt(s.slice(i,i+16),n);return n}let At=class extends D{constructor(s,t,e){if(s!=="SHA-1")throw new Error(M);super(s,t,e);const n=e||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=T(this.t,this.i,this.T),this.v=nt,this.L=function(i){return i.slice()},this.B=dt,this.F=mt,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,n.hmacKey&&this.k(K("hmacKey",n.hmacKey,this.T))}};function st(s){let t;return t=s=="SHA-224"?U.slice():S.slice(),t}function it(s,t){let e,n,i,o,u,a,c,f,g,h,w;const d=[];for(e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],a=t[5],c=t[6],f=t[7],w=0;w<64;w+=1)d[w]=w<16?s[w]:ft(R(m=d[w-2],17)^R(m,19)^Q(m,10),d[w-7],lt(d[w-15]),d[w-16]),g=k(f,gt(u),tt(u,a,c),l[w],d[w]),h=I(wt(e),et(e,n,i)),f=c,c=a,a=u,u=I(o,g),o=i,i=n,n=e,e=I(g,h);var m;return t[0]=I(e,t[0]),t[1]=I(n,t[1]),t[2]=I(i,t[2]),t[3]=I(o,t[3]),t[4]=I(u,t[4]),t[5]=I(a,t[5]),t[6]=I(c,t[6]),t[7]=I(f,t[7]),t}let pt=class extends D{constructor(s,t,e){if(s!=="SHA-224"&&s!=="SHA-256")throw new Error(M);super(s,t,e);const n=e||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=T(this.t,this.i,this.T),this.v=it,this.L=function(i){return i.slice()},this.B=st,this.F=function(i,o,u,a){return function(c,f,g,h,w){let d,m;const A=15+(f+65>>>9<<4),p=f+g;for(;c.length<=A;)c.push(0);for(c[f>>>5]|=128<<24-f%32,c[A]=4294967295&p,c[A-1]=p/F|0,d=0;d<c.length;d+=16)h=it(c.slice(d,d+16),h);return m=w==="SHA-224"?[h[0],h[1],h[2],h[3],h[4],h[5],h[6]]:h,m}(i,o,u,a,s)},this.U=st(s),this.m=512,this.R=s==="SHA-224"?224:256,this.K=!1,n.hmacKey&&this.k(K("hmacKey",n.hmacKey,this.T))}};class r{constructor(t,e){this.N=t,this.I=e}}function rt(s,t){let e;return t>32?(e=64-t,new r(s.I<<t|s.N>>>e,s.N<<t|s.I>>>e)):t!==0?(e=32-t,new r(s.N<<t|s.I>>>e,s.I<<t|s.N>>>e)):s}function L(s,t){let e;return t<32?(e=32-t,new r(s.N>>>t|s.I<<e,s.I>>>t|s.N<<e)):(e=64-t,new r(s.I>>>t|s.N<<e,s.N>>>t|s.I<<e))}function ot(s,t){return new r(s.N>>>t,s.I>>>t|s.N<<32-t)}function Nt(s,t,e){return new r(s.N&t.N^s.N&e.N^t.N&e.N,s.I&t.I^s.I&e.I^t.I&e.I)}function It(s){const t=L(s,28),e=L(s,34),n=L(s,39);return new r(t.N^e.N^n.N,t.I^e.I^n.I)}function H(s,t){let e,n;e=(65535&s.I)+(65535&t.I),n=(s.I>>>16)+(t.I>>>16)+(e>>>16);const i=(65535&n)<<16|65535&e;return e=(65535&s.N)+(65535&t.N)+(n>>>16),n=(s.N>>>16)+(t.N>>>16)+(e>>>16),new r((65535&n)<<16|65535&e,i)}function yt(s,t,e,n){let i,o;i=(65535&s.I)+(65535&t.I)+(65535&e.I)+(65535&n.I),o=(s.I>>>16)+(t.I>>>16)+(e.I>>>16)+(n.I>>>16)+(i>>>16);const u=(65535&o)<<16|65535&i;return i=(65535&s.N)+(65535&t.N)+(65535&e.N)+(65535&n.N)+(o>>>16),o=(s.N>>>16)+(t.N>>>16)+(e.N>>>16)+(n.N>>>16)+(i>>>16),new r((65535&o)<<16|65535&i,u)}function Et(s,t,e,n,i){let o,u;o=(65535&s.I)+(65535&t.I)+(65535&e.I)+(65535&n.I)+(65535&i.I),u=(s.I>>>16)+(t.I>>>16)+(e.I>>>16)+(n.I>>>16)+(i.I>>>16)+(o>>>16);const a=(65535&u)<<16|65535&o;return o=(65535&s.N)+(65535&t.N)+(65535&e.N)+(65535&n.N)+(65535&i.N)+(u>>>16),u=(s.N>>>16)+(t.N>>>16)+(e.N>>>16)+(n.N>>>16)+(i.N>>>16)+(o>>>16),new r((65535&u)<<16|65535&o,a)}function Y(s,t){return new r(s.N^t.N,s.I^t.I)}function Ht(s){const t=L(s,19),e=L(s,61),n=ot(s,6);return new r(t.N^e.N^n.N,t.I^e.I^n.I)}function vt(s){const t=L(s,1),e=L(s,8),n=ot(s,7);return new r(t.N^e.N^n.N,t.I^e.I^n.I)}function bt(s){const t=L(s,14),e=L(s,18),n=L(s,41);return new r(t.N^e.N^n.N,t.I^e.I^n.I)}const Rt=[new r(l[0],3609767458),new r(l[1],602891725),new r(l[2],3964484399),new r(l[3],2173295548),new r(l[4],4081628472),new r(l[5],3053834265),new r(l[6],2937671579),new r(l[7],3664609560),new r(l[8],2734883394),new r(l[9],1164996542),new r(l[10],1323610764),new r(l[11],3590304994),new r(l[12],4068182383),new r(l[13],991336113),new r(l[14],633803317),new r(l[15],3479774868),new r(l[16],2666613458),new r(l[17],944711139),new r(l[18],2341262773),new r(l[19],2007800933),new r(l[20],1495990901),new r(l[21],1856431235),new r(l[22],3175218132),new r(l[23],2198950837),new r(l[24],3999719339),new r(l[25],766784016),new r(l[26],2566594879),new r(l[27],3203337956),new r(l[28],1034457026),new r(l[29],2466948901),new r(l[30],3758326383),new r(l[31],168717936),new r(l[32],1188179964),new r(l[33],1546045734),new r(l[34],1522805485),new r(l[35],2643833823),new r(l[36],2343527390),new r(l[37],1014477480),new r(l[38],1206759142),new r(l[39],344077627),new r(l[40],1290863460),new r(l[41],3158454273),new r(l[42],3505952657),new r(l[43],106217008),new r(l[44],3606008344),new r(l[45],1432725776),new r(l[46],1467031594),new r(l[47],851169720),new r(l[48],3100823752),new r(l[49],1363258195),new r(l[50],3750685593),new r(l[51],3785050280),new r(l[52],3318307427),new r(l[53],3812723403),new r(l[54],2003034995),new r(l[55],3602036899),new r(l[56],1575990012),new r(l[57],1125592928),new r(l[58],2716904306),new r(l[59],442776044),new r(l[60],593698344),new r(l[61],3733110249),new r(l[62],2999351573),new r(l[63],3815920427),new r(3391569614,3928383900),new r(3515267271,566280711),new r(3940187606,3454069534),new r(4118630271,4000239992),new r(116418474,1914138554),new r(174292421,2731055270),new r(289380356,3203993006),new r(460393269,320620315),new r(685471733,587496836),new r(852142971,1086792851),new r(1017036298,365543100),new r(1126000580,2618297676),new r(1288033470,3409855158),new r(1501505948,4234509866),new r(1607167915,987167468),new r(1816402316,1246189591)];function ht(s){return s==="SHA-384"?[new r(3418070365,U[0]),new r(1654270250,U[1]),new r(2438529370,U[2]),new r(355462360,U[3]),new r(1731405415,U[4]),new r(41048885895,U[5]),new r(3675008525,U[6]),new r(1203062813,U[7])]:[new r(S[0],4089235720),new r(S[1],2227873595),new r(S[2],4271175723),new r(S[3],1595750129),new r(S[4],2917565137),new r(S[5],725511199),new r(S[6],4215389547),new r(S[7],327033209)]}function ut(s,t){let e,n,i,o,u,a,c,f,g,h,w,d;const m=[];for(e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],a=t[5],c=t[6],f=t[7],w=0;w<80;w+=1)w<16?(d=2*w,m[w]=new r(s[d],s[d+1])):m[w]=yt(Ht(m[w-2]),m[w-7],vt(m[w-15]),m[w-16]),g=Et(f,bt(u),(p=a,y=c,new r((A=u).N&p.N^~A.N&y.N,A.I&p.I^~A.I&y.I)),Rt[w],m[w]),h=H(It(e),Nt(e,n,i)),f=c,c=a,a=u,u=H(o,g),o=i,i=n,n=e,e=H(g,h);var A,p,y;return t[0]=H(e,t[0]),t[1]=H(n,t[1]),t[2]=H(i,t[2]),t[3]=H(o,t[3]),t[4]=H(u,t[4]),t[5]=H(a,t[5]),t[6]=H(c,t[6]),t[7]=H(f,t[7]),t}let Lt=class extends D{constructor(s,t,e){if(s!=="SHA-384"&&s!=="SHA-512")throw new Error(M);super(s,t,e);const n=e||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=T(this.t,this.i,this.T),this.v=ut,this.L=function(i){return i.slice()},this.B=ht,this.F=function(i,o,u,a){return function(c,f,g,h,w){let d,m;const A=31+(f+129>>>10<<5),p=f+g;for(;c.length<=A;)c.push(0);for(c[f>>>5]|=128<<24-f%32,c[A]=4294967295&p,c[A-1]=p/F|0,d=0;d<c.length;d+=32)h=ut(c.slice(d,d+32),h);return m=w==="SHA-384"?[h[0].N,h[0].I,h[1].N,h[1].I,h[2].N,h[2].I,h[3].N,h[3].I,h[4].N,h[4].I,h[5].N,h[5].I]:[h[0].N,h[0].I,h[1].N,h[1].I,h[2].N,h[2].I,h[3].N,h[3].I,h[4].N,h[4].I,h[5].N,h[5].I,h[6].N,h[6].I,h[7].N,h[7].I],m}(i,o,u,a,s)},this.U=ht(s),this.m=1024,this.R=s==="SHA-384"?384:512,this.K=!1,n.hmacKey&&this.k(K("hmacKey",n.hmacKey,this.T))}};const Ut=[new r(0,1),new r(0,32898),new r(2147483648,32906),new r(2147483648,2147516416),new r(0,32907),new r(0,2147483649),new r(2147483648,2147516545),new r(2147483648,32777),new r(0,138),new r(0,136),new r(0,2147516425),new r(0,2147483658),new r(0,2147516555),new r(2147483648,139),new r(2147483648,32905),new r(2147483648,32771),new r(2147483648,32770),new r(2147483648,128),new r(0,32778),new r(2147483648,2147483658),new r(2147483648,2147516545),new r(2147483648,32896),new r(0,2147483649),new r(2147483648,2147516424)],St=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function z(s){let t;const e=[];for(t=0;t<5;t+=1)e[t]=[new r(0,0),new r(0,0),new r(0,0),new r(0,0),new r(0,0)];return e}function Kt(s){let t;const e=[];for(t=0;t<5;t+=1)e[t]=s[t].slice();return e}function X(s,t){let e,n,i,o;const u=[],a=[];if(s!==null)for(n=0;n<s.length;n+=2)t[(n>>>1)%5][(n>>>1)/5|0]=Y(t[(n>>>1)%5][(n>>>1)/5|0],new r(s[n+1],s[n]));for(e=0;e<24;e+=1){for(o=z(),n=0;n<5;n+=1)u[n]=(c=t[n][0],f=t[n][1],g=t[n][2],h=t[n][3],w=t[n][4],new r(c.N^f.N^g.N^h.N^w.N,c.I^f.I^g.I^h.I^w.I));for(n=0;n<5;n+=1)a[n]=Y(u[(n+4)%5],rt(u[(n+1)%5],1));for(n=0;n<5;n+=1)for(i=0;i<5;i+=1)t[n][i]=Y(t[n][i],a[n]);for(n=0;n<5;n+=1)for(i=0;i<5;i+=1)o[i][(2*n+3*i)%5]=rt(t[n][i],St[n][i]);for(n=0;n<5;n+=1)for(i=0;i<5;i+=1)t[n][i]=Y(o[n][i],new r(~o[(n+1)%5][i].N&o[(n+2)%5][i].N,~o[(n+1)%5][i].I&o[(n+2)%5][i].I));t[0][0]=Y(t[0][0],Ut[e])}var c,f,g,h,w;return t}function ct(s){let t,e,n=0;const i=[0,0],o=[4294967295&s,s/F&2097151];for(t=6;t>=0;t--)e=o[t>>2]>>>8*t&255,e===0&&n===0||(i[n+1>>2]|=e<<8*(n+1),n+=1);return n=n!==0?n:1,i[0]|=n,{value:n+1>4?i:[i[0]],binLen:8+8*n}}function O(s){return P(ct(s.binLen),s)}function at(s,t){let e,n=ct(t);n=P(n,s);const i=t>>>2,o=(i-n.value.length%i)%i;for(e=0;e<o;e++)n.value.push(0);return n.value}let Tt=class extends D{constructor(s,t,e){let n=6,i=0;super(s,t,e);const o=e||{};if(this.numRounds!==1){if(o.kmacKey||o.hmacKey)throw new Error(G);if(this.o==="CSHAKE128"||this.o==="CSHAKE256")throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=T(this.t,this.i,this.T),this.v=X,this.L=Kt,this.B=z,this.U=z(),this.K=!1,s){case"SHA3-224":this.m=i=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=i=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=i=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=i=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":n=31,this.m=i=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":n=31,this.m=i=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":n=4,this.m=i=1344,this.X(e),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":n=4,this.m=i=1088,this.X(e),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=i=1344,n=this.O(e),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=i=1088,n=this.O(e),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(M)}this.F=function(u,a,c,f,g){return function(h,w,d,m,A,p,y){let N,v,E=0;const b=[],x=A>>>5,Mt=w>>>5;for(N=0;N<Mt&&w>=A;N+=x)m=X(h.slice(N,N+x),m),w-=A;for(h=h.slice(N),w%=A;h.length<x;)h.push(0);for(N=w>>>3,h[N>>2]^=p<<N%4*8,h[x-1]^=2147483648,m=X(h,m);32*b.length<y&&(v=m[E%5][E/5|0],b.push(v.I),!(32*b.length>=y));)b.push(v.N),E+=1,64*E%A==0&&(X(null,m),E=0);return b}(u,a,0,f,i,n,g)},o.hmacKey&&this.k(K("hmacKey",o.hmacKey,this.T))}O(s,t){const e=function(i){const o=i||{};return{funcName:K("funcName",o.funcName,1,{value:[],binLen:0}),customization:K("Customization",o.customization,1,{value:[],binLen:0})}}(s||{});t&&(e.funcName=t);const n=P(O(e.funcName),O(e.customization));if(e.customization.binLen!==0||e.funcName.binLen!==0){const i=at(n,this.m>>>3);for(let o=0;o<i.length;o+=this.m>>>5)this.U=this.v(i.slice(o,o+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(s){const t=function(n){const i=n||{};return{kmacKey:K("kmacKey",i.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:K("Customization",i.customization,1,{value:[],binLen:0})}}(s||{});this.O(s,t.funcName);const e=at(O(t.kmacKey),this.m>>>3);for(let n=0;n<e.length;n+=this.m>>>5)this.U=this.v(e.slice(n,n+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(s){const t=P({value:this.h.slice(),binLen:this.u},function(e){let n,i,o=0;const u=[0,0],a=[4294967295&e,e/F&2097151];for(n=6;n>=0;n--)i=a[n>>2]>>>8*n&255,i===0&&o===0||(u[o>>2]|=i<<8*o,o+=1);return o=o!==0?o:1,u[o>>2]|=o<<8*o,{value:o+1>4?u:[u[0]],binLen:8+8*o}}(s.outputLen));return this.F(t.value,t.binLen,this.A,this.L(this.U),s.outputLen)}};class Ct{constructor(t,e,n){if(t=="SHA-1")this.P=new At(t,e,n);else if(t=="SHA-224"||t=="SHA-256")this.P=new pt(t,e,n);else if(t=="SHA-384"||t=="SHA-512")this.P=new Lt(t,e,n);else{if(t!="SHA3-224"&&t!="SHA3-256"&&t!="SHA3-384"&&t!="SHA3-512"&&t!="SHAKE128"&&t!="SHAKE256"&&t!="CSHAKE128"&&t!="CSHAKE256"&&t!="KMAC128"&&t!="KMAC256")throw new Error(M);this.P=new Tt(t,e,n)}}update(t){return this.P.update(t),this}getHash(t,e){return this.P.getHash(t,e)}setHMACKey(t,e,n){this.P.setHMACKey(t,e,n)}getHMAC(t,e){return this.P.getHMAC(t,e)}}const B=class B{static async create(){return new B(await navigator.storage.getDirectory().then(t=>t.getDirectoryHandle(B.TopLevelDirectory,{create:!0})))}constructor(t){this.rootDirectoryHandle=t,this.downloading=!1}async keys(){return Array.fromAsync(this.rootDirectoryHandle.keys())}async verify(t,e){const n=await this.get(t),i=n.size;let o=new Ct("SHA-256","UINT8ARRAY"),u=0;for await(const c of n.stream())o.update(c),u+=c.length,e&&e(u/i);const a=o.getHash("HEX");if(a!==t)throw new Error(`shasum verification failed
expected: ${t}
got: ${a}`);return Promise.resolve(!0)}async has(t){try{return await this.rootDirectoryHandle.getFileHandle(t),!0}catch(e){if(e instanceof DOMException&&e.name==="NotFoundError")return!1;throw e}}async get(t){if(!await this.has(t))throw new DOMException(`${t} not found.`,"NotFoundError");return this.rootDirectoryHandle.getFileHandle(t).then(e=>e.getFile())}async delete(t){await this.has(t)&&await this.rootDirectoryHandle.removeEntry(t)}async clear(){for(const t of await this.keys())await this.delete(t)}async fetch(t,e,n){if(await this.has(t))throw new DOMException(`${t} already exists.`,"OperationError");this.downloading=!0;let i,u=await(await this.rootDirectoryHandle.getFileHandle(t,{create:!0})).createWritable();return fetch(e).then(a=>{if(a.status!==200)throw new Error(`http error. status code: ${a.status}`);if(!a.headers.get("content-length"))throw new Error(`response for ${e} is missing content-length header`);i=Number(a.headers.get("content-length"));let c=a.headers.get("content-type");return console.debug(`downloading ${e}. length: ${i}. type: ${c}.`),a}).then(a=>{let c=0;const f=a.body.getReader();return new ReadableStream({async start(g){for(;;){const{done:h,value:w}=await f.read();if(h){console.debug("Finished downloading ",e);break}g.enqueue(w),c+=w.length,n&&n(c/i)}g.close(),f.releaseLock()}})}).then(a=>a.pipeTo(u)).finally(()=>{this.downloading=!1})}};B.TopLevelDirectory="default";let $=B;async function Ft(s){if(!s.sha256)throw new Error("event data missing");const t=e=>{postMessage({type:"progress",i:e})};try{return await(await $.create()).verify(s.sha256,t),postMessage({type:"complete"}),!0}catch(e){return postMessage({type:"error",e}),!1}}onmessage=function(s){if(s.data.type==="start")Ft(s.data);else throw new Error(`unknown type: ${s.data.type}`)}})();
